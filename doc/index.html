<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rutland Vapes - Menu</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useEffect, useRef } = React;
    
    // Lucide icons as SVG components
    const Droplet = () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01" /></svg>;
    const LogOut = ({ className }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" /></svg>;
    const Upload = ({ className }) => <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" /></svg>;
    



const initialData = {
  nicSalt: { brands: {} },
  freebase: { brands: {} }
};

// CSV Import Modal
function CSVImportModal({ onClose, onImport, category }) {
  const [csvText, setCsvText] = useState('');
  const [status, setStatus] = useState('');

  const handleFileUpload = (e) => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = (event) => {
      setCsvText(event.target.result);
      setStatus('‚úÖ File loaded!');
    };
    reader.readAsText(file);
  };

  const handleImport = () => {
    if (!csvText.trim()) {
      setStatus('‚ùå Please upload CSV');
      return;
    }

    try {
      const lines = csvText.trim().split('\n');
      const headers = lines[0].split(',').map(h => h.trim());
      const products = [];
      const brands = new Set();

      for (let i = 1; i < lines.length; i++) {
        const line = lines[i].trim();
        if (!line) continue;

        const values = line.split(',').map(v => v.trim());
        const row = {};
        headers.forEach((header, index) => {
          row[header] = values[index] || '';
        });

        const brand = row['Brand'];
        const productName = row['Product Name'];
        if (!brand || !productName) continue;

        brands.add(brand);

        products.push({
          brand,
          product: {
            id: 'csv-' + Date.now() + '-' + i,
            name: productName,
            flavors: row['Flavor Description'] || productName,
            price: row['Price'] || '$0.00',
            nicotine: (row['Nicotine Strengths'] || '').split(/[,|]/).map(s => s.trim()).filter(s => s),
            image: row['Image URL'] || 'https://images.unsplash.com/photo-1587049352846-4a222e784720?w=400&h=400&fit=crop'
          }
        });
      }

      onImport({ products, brands: Array.from(brands) });
      setStatus(`‚úÖ Imported ${products.length} products!`);
      setTimeout(() => onClose(), 1500);
    } catch (error) {
      setStatus('‚ùå Error: ' + error.message);
    }
  };

  return (
    <div className="fixed inset-0 bg-black/80 flex items-center justify-center p-8 z-50" onClick={onClose}>
      <div className="bg-slate-800 rounded-xl p-8 max-w-4xl w-full" onClick={(e) => e.stopPropagation()}>
        <h3 className="text-2xl font-bold text-white mb-6">Import - {category}</h3>
        <input type="file" accept=".csv" onChange={handleFileUpload}
          className="w-full px-4 py-3 bg-slate-700 text-white rounded-lg mb-4 file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:bg-purple-600 file:text-white"
        />
        {status && <div className="mb-4 p-3 bg-slate-900 rounded-lg text-white">{status}</div>}
        <div className="flex gap-3">
          <button onClick={handleImport} className="flex-1 py-3 bg-green-600 text-white rounded-lg">Import</button>
          <button onClick={onClose} className="flex-1 py-3 bg-slate-700 text-white rounded-lg">Cancel</button>
        </div>
      </div>
    </div>
  );
}

// Edit Product Modal
function EditProductModal({ product, brandName, onClose, onSave, isNew, category }) {
  // Special pricing for 925, RV, FKR brands
  const specialBrands = ['925', '925 E-Liquids', 'RV', 'FKR'];
  const isSpecialBrand = specialBrands.includes(brandName);
  
  const getDefaultPrice = () => {
    if (category === 'nicSalt') {
      return isSpecialBrand ? '$19.99 - $24.99' : '$22.49 - $24.99';
    }
    // Freebase gets different special pricing
    if (category === 'freebase') {
      return isSpecialBrand ? '$16.24 - $19.49' : '$17.00 - $19.49';
    }
    return '';
  };
  
  const [form, setForm] = useState(product || {
    id: 'manual-' + Date.now(),
    name: '',
    flavors: '',
    price: getDefaultPrice(),
    nicotine: category === 'nicSalt' ? ['12mg', '20mg'] : [],
    image: 'https://images.unsplash.com/photo-1587049352846-4a222e784720?w=400&h=400&fit=crop',
    stockStatus: 'inStock'
  });
  const [nicInput, setNicInput] = useState('');
  const [useUrl, setUseUrl] = useState(true);
  const [urlInput, setUrlInput] = useState(product?.image || '');

  const handleImageUpload = (e) => {
    const file = e.target.files[0];
    if (!file || !file.type.startsWith('image/')) return;
    const reader = new FileReader();
    reader.onload = (ev) => setForm({ ...form, image: ev.target.result });
    reader.readAsDataURL(file);
  };

  const handleSave = () => {
    if (!form.name || !form.price) {
      alert('Please enter product name and price');
      return;
    }
    const productToSave = {
      ...form,
      image: useUrl ? urlInput : form.image
    };
    onClose();
    onSave(productToSave);
  };

  return (
    <div className="fixed inset-0 bg-black/80 flex items-center justify-center p-8 z-50 overflow-auto" onClick={onClose}>
      <div className="bg-slate-800 rounded-xl p-8 max-w-2xl w-full my-8" onClick={(e) => e.stopPropagation()}>
        <h3 className="text-2xl font-bold text-white mb-6">{isNew ? `Add Product to ${brandName}` : 'Edit Product'}</h3>
        <div className="space-y-4">
          <div>
            <label className="text-white text-sm mb-1 block">Product Name *</label>
            <input type="text" value={form.name} onChange={(e) => setForm({ ...form, name: e.target.value })}
              className="w-full px-4 py-2 bg-slate-700 text-white rounded-lg" />
          </div>
          <div>
            <label className="text-white text-sm mb-1 block">Flavor Description (searchable)</label>
            <input type="text" value={form.flavors} onChange={(e) => setForm({ ...form, flavors: e.target.value })}
              placeholder="e.g., Strawberry, Cream, Vanilla Ice"
              className="w-full px-4 py-2 bg-slate-700 text-white rounded-lg" />
            <p className="text-slate-400 text-xs mt-1">üí° This is what customers can search for</p>
          </div>
          <div>
            <label className="text-white text-sm mb-1 block">Price *</label>
            <input type="text" value={form.price} onChange={(e) => setForm({ ...form, price: e.target.value })}
              placeholder="$24.99"
              className="w-full px-4 py-2 bg-slate-700 text-white rounded-lg" />
          </div>
          <div>
            <label className="text-white text-sm mb-1 block">Nicotine Strengths</label>
            <div className="flex gap-2 mb-2">
              <input type="text" value={nicInput} onChange={(e) => setNicInput(e.target.value)} placeholder="20mg"
                className="flex-1 px-4 py-2 bg-slate-700 text-white rounded-lg" />
              <button onClick={() => { 
                if (nicInput && !form.nicotine.includes(nicInput)) {
                  setForm({ ...form, nicotine: [...form.nicotine, nicInput] });
                  setNicInput('');
                }
              }} className="px-4 py-2 bg-purple-600 text-white rounded-lg">Add</button>
            </div>
            <div className="flex flex-wrap gap-2">
              {form.nicotine.map((nic, i) => (
                <span key={i} className="bg-purple-600/30 text-purple-200 px-3 py-1 rounded-full flex items-center gap-2">
                  {nic}
                  <button onClick={() => setForm({ ...form, nicotine: form.nicotine.filter((_, idx) => idx !== i) })}>√ó</button>
                </span>
              ))}
            </div>
          </div>
          <div>
            <label className="text-white text-sm mb-1 block">Product Image</label>
            
            {/* Toggle between URL and Upload */}
            <div className="flex gap-2 mb-3">
              <button 
                onClick={() => setUseUrl(true)}
                type="button"
                className={`flex-1 py-2 rounded-lg font-semibold text-sm ${useUrl ? 'bg-purple-600 text-white' : 'bg-slate-700 text-slate-300'}`}
              >
                Image URL
              </button>
              <button 
                onClick={() => setUseUrl(false)}
                type="button"
                className={`flex-1 py-2 rounded-lg font-semibold text-sm ${!useUrl ? 'bg-purple-600 text-white' : 'bg-slate-700 text-slate-300'}`}
              >
                Upload File
              </button>
            </div>

            {useUrl ? (
              <>
                <input 
                  type="text"
                  value={urlInput}
                  onChange={(e) => setUrlInput(e.target.value)}
                  placeholder="https://cdn.shopify.com/..."
                  className="w-full px-4 py-2 bg-slate-700 text-white rounded-lg"
                />
                {urlInput && (
                  <img src={urlInput} alt="Preview" className="mt-3 w-32 h-32 object-cover rounded-lg" onError={(e) => e.target.style.display = 'none'} />
                )}
              </>
            ) : (
              <>
                <input type="file" accept="image/*" onChange={handleImageUpload}
                  className="w-full px-4 py-2 bg-slate-700 text-white rounded-lg file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:bg-purple-600 file:text-white" />
                {form.image && <img src={form.image} alt="Preview" className="mt-3 w-32 h-32 object-cover rounded-lg" />}
              </>
            )}
          </div>
          <div>
            <label className="text-white text-sm mb-1 block">Stock Status</label>
            <select 
              value={form.stockStatus || 'inStock'} 
              onChange={(e) => setForm({ ...form, stockStatus: e.target.value })}
              className="w-full px-4 py-2 bg-slate-700 text-white rounded-lg"
            >
              <option value="inStock">‚úÖ Reg Stocked Item</option>
              <option value="specialOrder">‚≠ê Special Order</option>
            </select>
            <p className="text-slate-400 text-xs mt-1">Special order items show a ‚≠ê badge on the product card</p>
            
            {/* Special Order Notes - Only show if special order selected */}
            {(form.stockStatus === 'specialOrder') && (
              <div className="mt-3">
                <label className="text-yellow-300 text-sm mb-1 block font-semibold">Special Order Notes</label>
                <textarea
                  value={form.specialOrderNotes || ''}
                  onChange={(e) => setForm({ ...form, specialOrderNotes: e.target.value })}
                  placeholder="e.g., 2-3 day lead time, minimum order 5 bottles, contact supplier..."
                  className="w-full px-4 py-3 bg-slate-700 text-white rounded-lg h-24 resize-none text-sm"
                />
                <p className="text-slate-400 text-xs mt-1">This note will appear when customers click the product</p>
              </div>
            )}
          </div>
        </div>
        <div className="flex gap-3 mt-6">
          <button 
            onClick={handleSave}
            className="flex-1 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 font-semibold"
          >
            Save
          </button>
          <button onClick={onClose} className="flex-1 py-3 bg-slate-700 text-slate-300 rounded-lg hover:bg-slate-600">
            Cancel
          </button>
        </div>
      </div>
    </div>
  );
}

// Edit Brand Logo Modal
function EditBrandModal({ brandName, currentImage, onClose, onSave }) {
  const [img, setImg] = useState(currentImage || '');
  const [urlInput, setUrlInput] = useState('');
  const [useUrl, setUseUrl] = useState(true); // Default to URL input

  const handleUpload = (e) => {
    const file = e.target.files[0];
    if (!file || !file.type.startsWith('image/')) return;
    const reader = new FileReader();
    reader.onload = (ev) => setImg(ev.target.result);
    reader.readAsDataURL(file);
  };

  const handleDone = () => {
    const finalImage = useUrl ? urlInput : img;
    if (!finalImage) {
      alert('Please provide an image URL or upload a file');
      return;
    }
    onSave(finalImage);
    onClose();
  };

  return (
    <div className="fixed inset-0 bg-black/80 flex items-center justify-center p-8 z-50" onClick={onClose}>
      <div className="bg-slate-800 rounded-xl p-8 max-w-md w-full" onClick={(e) => e.stopPropagation()}>
        <h3 className="text-2xl font-bold text-white mb-6">Brand Logo: {brandName}</h3>
        
        {/* Toggle between URL and Upload */}
        <div className="flex gap-2 mb-4">
          <button 
            onClick={() => setUseUrl(true)}
            className={`flex-1 py-2 rounded-lg font-semibold ${useUrl ? 'bg-purple-600 text-white' : 'bg-slate-700 text-slate-300'}`}
          >
            Image URL
          </button>
          <button 
            onClick={() => setUseUrl(false)}
            className={`flex-1 py-2 rounded-lg font-semibold ${!useUrl ? 'bg-purple-600 text-white' : 'bg-slate-700 text-slate-300'}`}
          >
            Upload File
          </button>
        </div>

        {useUrl ? (
          <>
            <label className="text-slate-300 text-sm mb-2 block">Paste Image URL:</label>
            <input 
              type="text"
              value={urlInput}
              onChange={(e) => setUrlInput(e.target.value)}
              placeholder="https://cdn.shopify.com/..."
              className="w-full px-4 py-3 bg-slate-700 text-white rounded-lg mb-4"
            />
            {urlInput && (
              <div className="mb-4">
                <p className="text-slate-400 text-xs mb-2">Preview:</p>
                <img src={urlInput} alt="Preview" className="w-full h-32 object-contain rounded bg-slate-900 p-4" onError={(e) => e.target.style.display = 'none'} />
              </div>
            )}
          </>
        ) : (
          <>
            <input type="file" accept="image/*" onChange={handleUpload}
              className="w-full px-4 py-3 bg-slate-700 text-white rounded-lg mb-4 file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:bg-purple-600 file:text-white" />
            {img && <img src={img} alt="Preview" className="w-full h-32 object-contain rounded bg-slate-900 p-4" />}
          </>
        )}

        <div className="mt-6">
          <button 
            onClick={handleDone}
            className="w-full py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 font-semibold"
          >
            Done
          </button>
        </div>
      </div>
    </div>
  );
}

// Edit Brand Name Modal
function EditBrandNameModal({ brandName, onClose, onSave }) {
  const [newName, setNewName] = useState(brandName);

  const handleSave = () => {
    if (!newName.trim() || newName === brandName) return;
    const nameToSave = newName.trim();
    onClose();
    onSave(nameToSave);
  };

  return (
    <div className="fixed inset-0 bg-black/80 flex items-center justify-center p-8 z-50" onClick={onClose}>
      <div className="bg-slate-800 rounded-xl p-8 max-w-md w-full" onClick={(e) => e.stopPropagation()}>
        <h3 className="text-2xl font-bold text-white mb-6">Edit Brand Name</h3>
        <div className="mb-4">
          <label className="text-slate-300 text-sm mb-2 block">Current: {brandName}</label>
          <input type="text" value={newName} onChange={(e) => setNewName(e.target.value)}
            placeholder="New Brand Name"
            className="w-full px-4 py-3 bg-slate-700 text-white rounded-lg" />
        </div>
        <div className="flex gap-3">
          <button 
            onClick={handleSave}
            disabled={!newName.trim() || newName === brandName}
            className="flex-1 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 font-semibold"
          >
            Save
          </button>
          <button onClick={onClose} className="flex-1 py-3 bg-slate-700 text-white rounded-lg">Cancel</button>
        </div>
      </div>
    </div>
  );
}

// Add Brand Modal
function AddBrandModal({ onClose, onSave }) {
  const [brandName, setBrandName] = useState('');

  const handleSave = () => {
    if (!brandName.trim()) return;
    const nameToSave = brandName.trim();
    onClose();
    onSave(nameToSave);
  };

  return (
    <div className="fixed inset-0 bg-black/80 flex items-center justify-center p-8 z-50" onClick={onClose}>
      <div className="bg-slate-800 rounded-xl p-8 max-w-md w-full" onClick={(e) => e.stopPropagation()}>
        <h3 className="text-2xl font-bold text-white mb-6">Add New Brand</h3>
        <input type="text" value={brandName} onChange={(e) => setBrandName(e.target.value)}
          placeholder="Brand Name"
          onKeyPress={(e) => e.key === 'Enter' && handleSave()}
          className="w-full px-4 py-3 bg-slate-700 text-white rounded-lg mb-4" />
        <div className="flex gap-3">
          <button 
            onClick={handleSave}
            disabled={!brandName.trim()}
            className="flex-1 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 font-semibold"
          >
            Add Brand
          </button>
          <button onClick={onClose} className="flex-1 py-3 bg-slate-700 text-white rounded-lg">Cancel</button>
        </div>
      </div>
    </div>
  );
}

// Delete Confirm Modal
function DeleteConfirmModal({ title, message, onConfirm, onCancel }) {
  return (
    <div className="fixed inset-0 bg-black/80 flex items-center justify-center p-8 z-50" onClick={onCancel}>
      <div className="bg-slate-800 rounded-xl p-8 max-w-md w-full" onClick={(e) => e.stopPropagation()}>
        <h3 className="text-2xl font-bold text-white mb-4">{title}</h3>
        <p className="text-slate-300 mb-6">{message}</p>
        <div className="flex gap-3">
          <button onClick={onConfirm} className="flex-1 py-3 bg-red-600 text-white rounded-lg">Delete</button>
          <button onClick={onCancel} className="flex-1 py-3 bg-slate-700 text-white rounded-lg">Cancel</button>
        </div>
      </div>
    </div>
  );
}

// Special Offer Modal
function SpecialOfferModal({ onClose, category }) {
  const getMessage = () => {
    if (category === 'nicSalt') {
      return (
        <p className="text-white text-xl mb-6 leading-relaxed">
          Don't forget to grab your second flavor for <span className="text-yellow-400 font-bold text-2xl">40% OFF</span>
        </p>
      );
    } else {
      // Freebase message
      return (
        <p className="text-white text-xl mb-6 leading-relaxed">
          Buy any <span className="text-yellow-400 font-bold text-2xl">5</span> FKR, 925 or RV E-liquids and get <span className="text-yellow-400 font-bold text-2xl">1 FREE</span>
        </p>
      );
    }
  };

  return (
    <div className="fixed inset-0 bg-black/80 flex items-center justify-center p-8 z-50" onClick={onClose}>
      <div className="bg-gradient-to-br from-purple-900 to-pink-900 rounded-xl p-8 max-w-md w-full border-4 border-yellow-400" onClick={(e) => e.stopPropagation()}>
        <div className="text-center">
          <div className="text-6xl mb-4">üéâ</div>
          <h3 className="text-3xl font-bold text-yellow-400 mb-4">SPECIAL OFFER!</h3>
          {getMessage()}
          <button onClick={onClose} className="w-full py-4 bg-yellow-400 text-purple-900 rounded-lg font-bold text-lg hover:bg-yellow-300">
            Got it! üëç
          </button>
        </div>
      </div>
    </div>
  );
}

// Backup Display Modal
function BackupDisplayModal({ onClose, data }) {
  const backupText = JSON.stringify(data, null, 2);
  
  const handleCopy = () => {
    navigator.clipboard.writeText(backupText).then(() => {
      alert('‚úÖ Copied to clipboard!');
    }).catch(() => {
      alert('Please manually select all text (Ctrl+A) and copy (Ctrl+C)');
    });
  };

  return (
    <div className="fixed inset-0 bg-black/80 flex items-center justify-center p-8 z-50" onClick={onClose}>
      <div className="bg-slate-800 rounded-xl p-8 max-w-4xl w-full max-h-[80vh] flex flex-col" onClick={(e) => e.stopPropagation()}>
        <h3 className="text-2xl font-bold text-white mb-4">Your Backup Data</h3>
        <div className="bg-yellow-900/30 border border-yellow-500/50 rounded-lg p-4 mb-4">
          <p className="text-yellow-200 text-sm">
            üìã <strong>Instructions:</strong><br/>
            1. Click "Copy to Clipboard" OR select all text (Ctrl+A / Cmd+A)<br/>
            2. Copy (Ctrl+C / Cmd+C)<br/>
            3. Paste into Notepad/TextEdit<br/>
            4. Save as: <strong>rutland-vapes-backup.json</strong>
          </p>
        </div>
        <textarea
          value={backupText}
          readOnly
          className="flex-1 w-full p-4 bg-slate-900 text-green-300 rounded-lg font-mono text-xs overflow-auto mb-4"
          onClick={(e) => e.target.select()}
        />
        <div className="flex gap-3">
          <button onClick={handleCopy} className="flex-1 py-3 bg-blue-600 text-white rounded-lg">
            üìã Copy to Clipboard
          </button>
          <button onClick={onClose} className="flex-1 py-3 bg-slate-700 text-white rounded-lg">
            Close
          </button>
        </div>
      </div>
    </div>
  );
}

// Import Backup Modal
function ImportBackupModal({ onClose, onImport }) {
  const [status, setStatus] = useState('');

  const handleFileUpload = (e) => {
    const file = e.target.files[0];
    if (!file) return;
    
    const reader = new FileReader();
    reader.onload = (event) => {
      try {
        const importedData = JSON.parse(event.target.result);
        
        // Validate structure
        if (!importedData || typeof importedData !== 'object') {
          throw new Error('Invalid format');
        }
        
        // Check for required top-level keys
        if (!importedData.nicSalt && !importedData.freebase) {
          throw new Error('Missing category data');
        }
        
        // Data is valid, import it (extra fields like "ingredients" are fine)
        onImport(importedData);
        setStatus('‚úÖ Backup restored successfully!');
        setTimeout(() => onClose(), 1500);
      } catch (error) {
        setStatus('‚ùå Invalid backup file: ' + error.message);
      }
    };
    reader.readAsText(file);
  };

  return (
    <div className="fixed inset-0 bg-black/80 flex items-center justify-center p-8 z-50" onClick={onClose}>
      <div className="bg-slate-800 rounded-xl p-8 max-w-md w-full" onClick={(e) => e.stopPropagation()}>
        <h3 className="text-2xl font-bold text-white mb-6">Restore Backup</h3>
        <div className="mb-4 p-4 bg-yellow-900/30 border border-yellow-500/50 rounded-lg">
          <p className="text-yellow-200 text-sm">‚ö†Ô∏è This will replace all current data!</p>
        </div>
        <input type="file" accept=".json" onChange={handleFileUpload}
          className="w-full px-4 py-3 bg-slate-700 text-white rounded-lg mb-4 file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:bg-purple-600 file:text-white"
        />
        {status && <div className="mb-4 p-3 bg-slate-900 rounded-lg text-white text-sm">{status}</div>}
        <button onClick={onClose} className="w-full py-3 bg-slate-700 text-white rounded-lg">Cancel</button>
      </div>
    </div>
  );
}

// Main Component
function VapeMenu() {
  const [loggedIn, setLoggedIn] = useState(false); // Start in customer mode - admin must login
  const [password, setPassword] = useState('');
  const [data, setData] = useState(initialData);
  const [category, setCategory] = useState('nicSalt');
  const [selectedBrand, setSelectedBrand] = useState(null);
  const [showImport, setShowImport] = useState(false);
  const [editingProduct, setEditingProduct] = useState(null);
  const [editingBrand, setEditingBrand] = useState(null);
  const [editingBrandName, setEditingBrandName] = useState(null);
  const [showAddBrand, setShowAddBrand] = useState(false);
  const [showAddProduct, setShowAddProduct] = useState(false);
  const [deleteConfirm, setDeleteConfirm] = useState(null);
  const [searchQuery, setSearchQuery] = useState('');
  const [showImportBackup, setShowImportBackup] = useState(false);
  const [showBackupDisplay, setShowBackupDisplay] = useState(false);
  const [showSpecialOffer, setShowSpecialOffer] = useState(false);
  const [bulkSelectedIds, setBulkSelectedIds] = useState([]);
  const [bulkDeleteMode, setBulkDeleteMode] = useState(false);
  const productsRef = useRef(null);

  useEffect(() => {
    try {
      const saved = localStorage.getItem('vape-shop-data');
      if (saved) setData(JSON.parse(saved));
    } catch (e) {}
  }, []);

  const saveData = (newData) => {
    localStorage.setItem('vape-shop-data', JSON.stringify(newData));
    setData(newData);
  };

  const handleLogin = () => {
    if (password === 'admin123') setLoggedIn(true);
  };

  const handleImport = ({ products, brands }) => {
    const newData = { ...data };
    brands.forEach(brandName => {
      if (!newData[category].brands[brandName]) {
        newData[category].brands[brandName] = { products: [], brandImage: null };
      }
    });
    products.forEach(({ brand, product }) => {
      newData[category].brands[brand].products.push(product);
    });
    saveData(newData);
    if (brands.length > 0) setSelectedBrand(brands[0]);
  };

  const handleImportBackup = (importedData) => {
    saveData(importedData);
    setShowImportBackup(false);
    alert('Backup restored successfully!');
  };

  const handleBrandClick = (brand) => {
    setSelectedBrand(brand);
    
    // Show popup for special brands
    const specialBrands = ['925', '925 E-Liquids', 'RV', 'FKR'];
    if (specialBrands.includes(brand)) {
      setTimeout(() => {
        setShowSpecialOffer(true);
      }, 300);
    }
    
    setTimeout(() => {
      if (productsRef.current) {
        productsRef.current.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
    }, 100);
  };

  const handleSaveProduct = (productData) => {
    const newData = { ...data };
    const brandProducts = newData[category].brands[selectedBrand].products;
    
    if (editingProduct && !showAddProduct) {
      // Editing existing product
      const index = brandProducts.findIndex(p => p.id === editingProduct.id);
      if (index >= 0) {
        brandProducts[index] = productData;
      }
    } else {
      // Adding new product
      brandProducts.push(productData);
    }
    
    saveData(newData);
    setEditingProduct(null);
    setShowAddProduct(false);
  };

  const handleDeleteProduct = () => {
    const newData = { ...data };
    newData[category].brands[selectedBrand].products = 
      newData[category].brands[selectedBrand].products.filter(p => p.id !== deleteConfirm.id);
    saveData(newData);
    setDeleteConfirm(null);
  };

  const handleBulkDelete = () => {
    if (bulkSelectedIds.length === 0) {
      alert('No products selected');
      return;
    }
    
    if (!window.confirm(`Delete ${bulkSelectedIds.length} selected product(s)?`)) {
      return;
    }
    
    const newData = { ...data };
    newData[category].brands[selectedBrand].products = 
      newData[category].brands[selectedBrand].products.filter(
        p => !bulkSelectedIds.includes(p.id)
      );
    saveData(newData);
    setBulkSelectedIds([]);
    setBulkDeleteMode(false);
  };

  const handleSaveBrand = (imageData) => {
    const newData = { ...data };
    newData[category].brands[editingBrand].brandImage = imageData;
    // Close modal immediately
    setEditingBrand(null);
    // Save in background
    setTimeout(() => {
      saveData(newData);
    }, 10);
  };

  const handleAddBrand = (brandName) => {
    const newData = { ...data };
    if (!newData[category].brands[brandName]) {
      newData[category].brands[brandName] = { products: [], brandImage: null };
      saveData(newData);
      setSelectedBrand(brandName);
    }
    setShowAddBrand(false);
  };

  const handleDeleteBrand = () => {
    const newData = { ...data };
    delete newData[category].brands[deleteConfirm.name];
    saveData(newData);
    if (selectedBrand === deleteConfirm.name) setSelectedBrand(null);
    setDeleteConfirm(null);
  };

  const handleSaveBrandName = (newName) => {
    const newData = { ...data };
    const oldBrand = newData[category].brands[editingBrandName];
    
    // Create new brand with new name
    newData[category].brands[newName] = oldBrand;
    
    // Delete old brand
    delete newData[category].brands[editingBrandName];
    
    saveData(newData);
    
    // Update selected brand if it was the one being edited
    if (selectedBrand === editingBrandName) {
      setSelectedBrand(newName);
    }
    
    setEditingBrandName(null);
  };

  const updateAllNicSaltProducts = () => {
    if (!confirm('Update ALL Nic Salt products with:\n‚Ä¢ Price: $22.49 - $24.99 (if empty)\n‚Ä¢ Nicotine: 12mg, 20mg (added to existing)\n\nContinue?')) {
      return;
    }

    const newData = { ...data };
    let updatedCount = 0;

    Object.keys(newData.nicSalt.brands).forEach(brandName => {
      const products = newData.nicSalt.brands[brandName].products || [];
      
      products.forEach(product => {
        let updated = false;
        
        // Update price if empty
        if (!product.price || product.price === '$0.00' || product.price === '') {
          product.price = '$22.49 - $24.99';
          updated = true;
        }
        
        // Update nicotine - add 12mg and 20mg if missing
        const currentNic = product.nicotine || [];
        if (!currentNic.includes('12mg')) {
          currentNic.push('12mg');
          updated = true;
        }
        if (!currentNic.includes('20mg')) {
          currentNic.push('20mg');
          updated = true;
        }
        product.nicotine = currentNic;
        
        if (updated) updatedCount++;
      });
    });

    saveData(newData);
    alert(`‚úÖ Updated ${updatedCount} products!\n\nRefresh to see changes.`);
  };

  const categoryData = data[category].brands;
  const brandNames = Object.keys(categoryData).sort();
  const selectedProducts = selectedBrand && categoryData[selectedBrand] ? categoryData[selectedBrand].products : [];
  
  // Filter products by search query - search across ALL brands in category
  const allProducts = Object.entries(categoryData).flatMap(([brandName, brandData]) => 
    (brandData.products || []).map(product => ({ ...product, brandName }))
  );
  
  const searchResults = searchQuery 
    ? allProducts.filter(p => 
        p.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
        p.flavors.toLowerCase().includes(searchQuery.toLowerCase())
      )
    : [];
  
  const filteredProducts = searchQuery 
    ? selectedProducts.filter(p => 
        p.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
        p.flavors.toLowerCase().includes(searchQuery.toLowerCase())
      )
    : selectedProducts;

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 p-8">
      <div className="max-w-7xl mx-auto">
        
        <div className="text-center mb-8 relative">
          <h1 className="text-7xl font-black text-transparent bg-clip-text bg-gradient-to-r from-purple-400 via-pink-500 to-purple-600 mb-4 tracking-tight" style={{ fontFamily: 'system-ui, -apple-system, "Segoe UI", sans-serif', letterSpacing: '-0.02em' }}>
            RUTLAND VAPES
          </h1>
          <div className="text-purple-300 text-xl font-light tracking-widest">PREMIUM E-LIQUID COLLECTION</div>
          {loggedIn && (
            <>
              <button onClick={() => setLoggedIn(false)} className="absolute top-0 right-0 px-4 py-2 bg-slate-700 text-white rounded-lg">
                <LogOut className="w-4 h-4 inline mr-2" />Logout
              </button>
              <button onClick={() => setShowImport(true)} className="absolute top-12 right-0 px-4 py-2 bg-green-600 text-white rounded-lg">
                <Upload className="w-4 h-4 inline mr-2" />Import CSV
              </button>
              <button onClick={() => setShowBackupDisplay(true)} className="absolute top-24 right-0 px-4 py-2 bg-blue-600 text-white rounded-lg text-sm">
                üìã Copy Backup
              </button>
              <button onClick={() => setShowImportBackup(true)} className="absolute top-36 right-0 px-4 py-2 bg-orange-600 text-white rounded-lg text-sm">
                üì• Restore Backup
              </button>
            </>
          )}
        </div>

        <div className="flex gap-4 mb-6">
          <button onClick={() => { setCategory('nicSalt'); setSelectedBrand(null); }}
            className={`flex-1 py-4 rounded-xl font-semibold text-xl ${category === 'nicSalt' ? 'bg-purple-600 text-white' : 'bg-slate-800 text-slate-300'}`}>
            Nic Salt ({Object.keys(data.nicSalt.brands).length})
          </button>
          <button onClick={() => { setCategory('freebase'); setSelectedBrand(null); }}
            className={`flex-1 py-4 rounded-xl font-semibold text-xl ${category === 'freebase' ? 'bg-purple-600 text-white' : 'bg-slate-800 text-slate-300'}`}>
            Freebase ({Object.keys(data.freebase.brands).length})
          </button>
        </div>

        {/* Global Search Bar */}
        {category && (
          <div className="mb-6">
            <div className="relative">
              <svg className="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
              </svg>
              <input
                type="text"
                value={searchQuery}
                onChange={(e) => setSearchQuery(e.target.value)}
                placeholder={`Search all ${category === 'nicSalt' ? 'Nic Salt' : 'Freebase'} products by name or flavor...`}
                className="w-full pl-12 pr-4 py-3 bg-slate-800 text-white rounded-xl border-2 border-slate-700 focus:border-purple-500 focus:outline-none"
              />
              {searchQuery && (
                <button 
                  onClick={() => setSearchQuery('')}
                  className="absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 hover:text-white text-2xl"
                >
                  √ó
                </button>
              )}
            </div>
          </div>
        )}

        {/* Global Search Results */}
        {searchQuery && searchResults.length > 0 && !selectedBrand && (
          <div className="mb-6">
            <h2 className="text-2xl font-bold text-white mb-4">Search Results - {searchResults.length} products found</h2>
            <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6">
              {searchResults.map((product, idx) => (
                <div key={product.id || idx} className="bg-slate-800 rounded-xl overflow-hidden border border-purple-500/20 group relative">
                  <img src={product.image} alt={product.name} className="w-full h-48 object-cover" />
                  <div className="p-4">
                    <div className="text-xs text-purple-400 font-semibold mb-2 uppercase">{product.brandName}</div>
                    <h3 className="text-lg font-bold text-white mb-1">{product.name}</h3>
                    <p className="text-purple-300 text-sm mb-3">{product.flavors}</p>
                    <div className="flex flex-wrap gap-1 mb-3">
                      {product.nicotine && product.nicotine.slice(0, 3).map((str, i) => (
                        <span key={i} className="bg-purple-600/30 text-purple-200 px-2 py-0.5 rounded text-xs">{str}</span>
                      ))}
                    </div>
                    <div className="text-xl font-bold text-purple-400">{product.price}</div>
                  </div>
                  <button 
                    onClick={() => {
                      setSelectedBrand(product.brandName);
                      setEditingProduct(product);
                      
                      // Show popup for special brands
                      const specialBrands = ['925', '925 E-Liquids', 'RV', 'FKR'];
                      if (specialBrands.includes(product.brandName)) {
                        setTimeout(() => {
                          setShowSpecialOffer(true);
                        }, 300);
                      }
                    }}
                    className="absolute top-2 right-2 p-2 bg-blue-600 text-white rounded opacity-0 group-hover:opacity-100 hover:bg-blue-700"
                  >
                    <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
                    </svg>
                  </button>
                </div>
              ))}
            </div>
          </div>
        )}

        {searchQuery && searchResults.length === 0 && !selectedBrand && (
          <div className="text-center py-12 mb-6">
            <p className="text-slate-400 mb-2">No products found matching "{searchQuery}"</p>
            <button onClick={() => setSearchQuery('')} className="text-purple-400 hover:text-purple-300">Clear search</button>
          </div>
        )}

        {brandNames.length > 0 && !searchQuery && (
          <div className="mb-6">
            <div className="flex items-center justify-between mb-3">
              <h3 className="text-white text-lg font-semibold">Brands:</h3>
              {loggedIn && (
                <button onClick={() => setShowAddBrand(true)} 
                  className="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 font-semibold">
                  + Add Brand
                </button>
              )}
            </div>
            <div className="grid grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4">
              {brandNames.map(brand => {
                const brandImage = categoryData[brand].brandImage;
                return (
                  <div key={brand} className="relative group">
                    <button onClick={() => handleBrandClick(brand)}
                      className={`w-full aspect-square rounded-xl p-4 flex flex-col items-center justify-center ${
                        selectedBrand === brand ? 'bg-purple-600 text-white' : 'bg-slate-800 text-slate-300 hover:bg-slate-700'
                      }`}>
                      {brandImage ? (
                        <div className="w-full h-full flex flex-col items-center justify-center">
                          <img src={brandImage} alt={brand} className="w-full h-3/4 object-contain mb-2" />
                          <span className="font-bold text-xs text-center">{brand}</span>
                        </div>
                      ) : (
                        <>
                          <span className="font-bold text-sm text-center mb-1">{brand}</span>
                          <span className="text-xs">({categoryData[brand].products.length})</span>
                        </>
                      )}
                    </button>
                    {loggedIn && (
                      <div className="absolute top-2 right-2 flex gap-1 opacity-0 group-hover:opacity-100">
                        <button 
                          onClick={(e) => { e.stopPropagation(); setEditingBrandName(brand); }}
                          className="p-2 bg-yellow-600 text-white rounded hover:bg-yellow-700"
                          title="Edit brand name"
                        >
                          <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
                          </svg>
                        </button>
                        <button 
                          onClick={(e) => { e.stopPropagation(); setEditingBrand(brand); }}
                          className="p-2 bg-blue-600 text-white rounded hover:bg-blue-700"
                          title="Edit brand logo"
                        >
                          <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                          </svg>
                        </button>
                        <button 
                          onClick={(e) => { e.stopPropagation(); setDeleteConfirm({ type: 'brand', name: brand, count: categoryData[brand].products.length }); }}
                          className="p-2 bg-red-600 text-white rounded hover:bg-red-700"
                          title="Delete brand"
                        >
                          <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                          </svg>
                        </button>
                      </div>
                    )}
                  </div>
                );
              })}
            </div>
          </div>
        )}

        {selectedBrand && (
          <div ref={productsRef} className="mb-6">
            <div className="flex items-center justify-between mb-4">
              <h2 className="text-2xl font-bold text-white">{selectedBrand} - {filteredProducts.length} products</h2>
              {loggedIn && (
                <div className="flex gap-2">
                  {!bulkDeleteMode ? (
                    <>
                      <button onClick={() => setShowAddProduct(true)}
                        className="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 font-semibold">
                        + Add Product
                      </button>
                      {filteredProducts.length > 0 && (
                        <button 
                          onClick={() => setBulkDeleteMode(true)}
                          className="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 font-semibold"
                        >
                          Select Multiple
                        </button>
                      )}
                    </>
                  ) : (
                    <>
                      <button 
                        onClick={() => {
                          setBulkSelectedIds([]);
                          setBulkDeleteMode(false);
                        }}
                        className="px-4 py-2 bg-slate-600 text-white rounded-lg hover:bg-slate-700 font-semibold"
                      >
                        Cancel
                      </button>
                      <button 
                        onClick={handleBulkDelete}
                        className="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 font-semibold"
                        disabled={bulkSelectedIds.length === 0}
                      >
                        Delete ({bulkSelectedIds.length})
                      </button>
                    </>
                  )}
                </div>
              )}
            </div>
            
            {filteredProducts.length > 0 ? (
              <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6">
                {filteredProducts.map((product, idx) => (
                  <div key={product.id || idx} className="bg-slate-800 rounded-xl overflow-hidden border border-purple-500/20 group relative">
                    {bulkDeleteMode && (
                      <div className="absolute top-2 left-2 z-20">
                        <input
                          type="checkbox"
                          checked={bulkSelectedIds.includes(product.id)}
                          onChange={(e) => {
                            if (e.target.checked) {
                              setBulkSelectedIds([...bulkSelectedIds, product.id]);
                            } else {
                              setBulkSelectedIds(bulkSelectedIds.filter(id => id !== product.id));
                            }
                          }}
                          className="w-6 h-6 cursor-pointer"
                          onClick={(e) => e.stopPropagation()}
                        />
                      </div>
                    )}
                    {product.stockStatus === 'specialOrder' && (
                      <div className="absolute top-2 right-2 z-10 bg-yellow-500 text-slate-900 px-2 py-1 rounded-full text-xs font-bold">
                        ‚≠ê Special Order
                      </div>
                    )}
                    <img src={product.image} alt={product.name} className="w-full h-48 object-cover" />
                    <div className="p-4">
                      <h3 className="text-lg font-bold text-white mb-1">{product.name}</h3>
                      <p className="text-purple-300 text-sm mb-3">{product.flavors}</p>
                      <div className="flex flex-wrap gap-1 mb-3">
                        {product.nicotine && product.nicotine.slice(0, 3).map((str, i) => (
                          <span key={i} className="bg-purple-600/30 text-purple-200 px-2 py-0.5 rounded text-xs">{str}</span>
                        ))}
                      </div>
                      <div className="text-xl font-bold text-purple-400">{product.price}</div>
                      
                      {/* Special Order Notes - Collapsible */}
                      {product.stockStatus === 'specialOrder' && product.specialOrderNotes && (
                        <details className="mt-3">
                          <summary className="cursor-pointer text-yellow-400 text-xs font-semibold hover:text-yellow-300">
                            üìù Special Order Info
                          </summary>
                          <div className="mt-2 p-2 bg-slate-900/50 rounded text-slate-300 text-xs">
                            {product.specialOrderNotes}
                          </div>
                        </details>
                      )}
                    </div>
                    {loggedIn && !bulkDeleteMode && (
                      <div className="absolute top-2 right-2 flex gap-1 opacity-0 group-hover:opacity-100">
                        <button 
                          onClick={() => setEditingProduct(product)} 
                          className="p-2 bg-blue-600 text-white rounded hover:bg-blue-700"
                        >
                          <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
                          </svg>
                        </button>
                        <button 
                          onClick={() => setDeleteConfirm({ type: 'product', id: product.id, name: product.name })} 
                          className="p-2 bg-red-600 text-white rounded hover:bg-red-700"
                        >
                          <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                          </svg>
                        </button>
                      </div>
                    )}
                  </div>
                ))}
              </div>
            ) : (
              <div className="text-center py-12">
                {searchQuery ? (
                  <>
                    <p className="text-slate-400 mb-2">No products found matching "{searchQuery}"</p>
                    <button onClick={() => setSearchQuery('')} className="text-purple-400 hover:text-purple-300">Clear search</button>
                  </>
                ) : (
                  <>
                    <p className="text-slate-400 mb-4">No products yet</p>
                    <button onClick={() => setShowAddProduct(true)} className="px-6 py-3 bg-green-600 text-white rounded-lg font-semibold">
                      + Add First Product
                    </button>
                  </>
                )}
              </div>
            )}
          </div>
        )}

        {brandNames.length === 0 && (
          <div className="text-center py-20">
            <Droplet className="w-24 h-24 text-purple-400/30 mx-auto mb-6" />
            <p className="text-slate-400 text-xl mb-4">No products yet</p>
            <button onClick={() => setShowImport(true)} className="px-6 py-3 bg-green-600 text-white rounded-lg">Import Products</button>
          </div>
        )}

        {/* Admin Login Button - Bottom Center (only visible when logged out) */}
        {!loggedIn && (
          <div className="fixed bottom-6 left-1/2 transform -translate-x-1/2 z-50">
            <button
              onClick={() => {
                const pwd = prompt('Enter admin password:');
                if (pwd === 'admin123') {
                  setLoggedIn(true);
                } else if (pwd !== null) {
                  alert('Incorrect password');
                }
              }}
              className="bg-slate-700 hover:bg-slate-600 text-white px-6 py-3 rounded-lg shadow-2xl flex items-center gap-2 font-semibold"
            >
              <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
              </svg>
              üîí Admin Login
            </button>
          </div>
        )}

      </div>

      {showImport && <CSVImportModal onClose={() => setShowImport(false)} onImport={handleImport} category={category === 'nicSalt' ? 'Nic Salt' : 'Freebase'} />}
      {showImportBackup && <ImportBackupModal onClose={() => setShowImportBackup(false)} onImport={handleImportBackup} />}
      {showBackupDisplay && <BackupDisplayModal onClose={() => setShowBackupDisplay(false)} data={data} />}
      {showSpecialOffer && <SpecialOfferModal onClose={() => setShowSpecialOffer(false)} category={category} />}
      {editingProduct && <EditProductModal product={editingProduct} brandName={selectedBrand} category={category} onClose={() => setEditingProduct(null)} onSave={handleSaveProduct} isNew={false} />}
      {showAddProduct && <EditProductModal brandName={selectedBrand} category={category} onClose={() => setShowAddProduct(false)} onSave={handleSaveProduct} isNew={true} />}
      {editingBrand && <EditBrandModal brandName={editingBrand} currentImage={categoryData[editingBrand]?.brandImage || ''} onClose={() => setEditingBrand(null)} onSave={handleSaveBrand} />}
      {editingBrandName && <EditBrandNameModal brandName={editingBrandName} onClose={() => setEditingBrandName(null)} onSave={handleSaveBrandName} />}
      {showAddBrand && <AddBrandModal onClose={() => setShowAddBrand(false)} onSave={handleAddBrand} />}
      {deleteConfirm && deleteConfirm.type === 'brand' && (
        <DeleteConfirmModal 
          title="Delete Brand" 
          message={`Delete "${deleteConfirm.name}" and all ${deleteConfirm.count} products?`}
          onConfirm={handleDeleteBrand}
          onCancel={() => setDeleteConfirm(null)}
        />
      )}
      {deleteConfirm && deleteConfirm.type === 'product' && (
        <DeleteConfirmModal 
          title="Delete Product" 
          message={`Delete "${deleteConfirm.name}"?`}
          onConfirm={handleDeleteProduct}
          onCancel={() => setDeleteConfirm(null)}
        />
      )}

      {/* Floating Add Product Button - Bottom Right */}
      {loggedIn && selectedBrand && !bulkDeleteMode && (
        <button
          onClick={() => setShowAddProduct(true)}
          className="fixed bottom-6 right-6 bg-green-600 hover:bg-green-700 text-white rounded-full p-4 shadow-2xl z-50 flex items-center gap-2 font-semibold"
          style={{ boxShadow: '0 10px 40px rgba(0,0,0,0.3)' }}
        >
          <span className="text-2xl">+</span> Add Product
        </button>
      )}
    </div>
  );
}


    ReactDOM.render(<VapeMenu />, document.getElementById('root'));
  </script>
</body>
</html>
